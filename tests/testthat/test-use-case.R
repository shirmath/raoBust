
test_that("works on a real use case", {

  my_df <- structure(list(yy = c(87928L, 139438L, 163794L, 53806L, 63075L,
                                 27126L, 290005L, 104522L, 170096L, 131047L, 35917L, 36306L, 139066L,
                                 247089L, 106406L, 397543L, 35169L, 153151L, 20801L, 36922L),
                          xstar = c(17, 12, 13, 21, 18, 28, 15, 15, 15, 16, 21, 19,
                                    17, 14, 22, 15, 26, 18, 26, 20),
                          xx = c(94, 78, 86, 101,
                                 92, 111, 108, 88, 97, 97, 93, 86, 103, 99, 120, 115, 110,
                                 110, 99, 90),
                          predictor = c(-1.71008143821379, -1.87180217690159,
                                        -1.88939793879197, -1.57059807911784, -1.63141681915288,
                                        -1.37732569113713, -1.97408102602201, -1.769286613376, -1.86666077740117,
                                        -1.8021222562636, -1.48807705542983, -1.50990831708707, -1.80151564417342,
                                        -1.95606252051933, -1.69644928942373, -2.03688192726104,
                                        -1.44238382777093, -1.81010860789625, -1.33702331211311,
                                        -1.50407739677627)),
                     class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA, -20L))


  expect_silent({

    glm1 <- glm_test(formula = yy ~ predictor,
                     family=poisson(link="log"),
                     data=my_df)
    glm2 <- glm_test(formula = yy ~ predictor,
                     family=poisson(link="log"),
                     offset=log(xx),
                     data=my_df)
  })
  expect_type(glm1$coef_tab,
              "double")

  expect_type(glm2$coef_tab,
              "double")

})


test_that("works on another real use case", {

  my_df <- structure(list(yy = c(46954L, 163732L, 117435L, 9182L, 7425L,
                              72014L, 33203L, 16822L, 141676L, 691395L, 20855L, 4357L, 45739L,
                              39204L, 189238L, 86452L, 276154L, 17860L, 219124L, 39052L),
                       xstar = c(384,
                                 420, 398, 377, 368, 414, 414, 392, 414, 436, 402, 380, 415, 393,
                                 419, 399, 428, 387, 422, 390),
                       xx = c(380, 391, 376, 406, 400,
                              402, 419, 410, 388, 377, 416, 426, 413, 393, 387, 383, 388, 403,
                              387, 390),
                       predictor = c(0.0104712998672954, 0.0715471512920483,
                                     0.0568628618945432, -0.0741079721537218, -0.083381608939051,
                                     0.0294138852062934, -0.0120049460968234, -0.044895319907891,
                                     0.0648606342020409, 0.145397055901024, -0.0342331716422422, -0.114268093548939,
                                     0.00483092726966559, 0, 0.079446226892356, 0.0409264277092175,
                                     0.0981178559585234, -0.0405118689169012, 0.0865806210062301,
                                     0), wts = c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                                 1, 1, 1)), row.names = c(NA, -20L), class = c("tbl_df", "tbl",
                                                                                               "data.frame"))


  expect_silent({

    glm1 <- glm_test(formula = yy ~ predictor,
                     family=poisson(link="log"),
                     data=my_df)
    glm2 <- glm_test(formula = yy ~ predictor,
                     family=poisson(link="log"),
                     offset=log(xx),
                     data=my_df)
  })
  expect_type(glm1$coef_tab,
              "double")

  expect_type(glm2$coef_tab,
              "double")

})
